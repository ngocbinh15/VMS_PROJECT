<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Warehouse - Modern UI</title>

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <link
    href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Plus+Jakarta+Sans:wght@600;700;800&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="./css/style.css">
</head>

<body>

  <nav class="navbar navbar-expand-lg fixed-top glass-nav">
    <div class="container-fluid px-4">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <div class="bg-primary text-white p-2 rounded-3 lh-1"><i class="bi bi-box-seam-fill"></i></div>
        <span class="brand-gradient">Warehouse</span>
      </a>
      <div class="mx-auto d-none d-md-flex align-items-center bg-light rounded-pill px-1 p-1 border">
        <span class="text-muted fw-bold px-3 small text-uppercase">Khu vực</span>
        <select class="form-select border-0 bg-white shadow-sm fw-bold text-dark rounded-pill py-1 ps-3 pe-5"
          id="currentWarehouse" style="cursor: pointer;">
          <option value="1">Kho Tổng</option>
          <option value="2">Trạm Bình Thuận</option>
          <option value="3">Trạm Bình Định</option>
        </select>
      </div>
      <div class="d-flex align-items-center gap-3">
        <div class="text-end d-none d-sm-block">
          <div class="fw-bold text-dark small">Nguyễn Ngọc Bình</div>
          <div class="text-muted" style="font-size: 0.7rem;">Admin Kho</div>
        </div>
        <div class="bg-primary text-white rounded-circle d-flex align-items-center justify-content-center fw-bold"
          style="width: 40px; height: 40px;">AD</div>
      </div>
    </div>
  </nav>

  <div class="container-fluid px-4 pb-5">
    <div class="d-flex justify-content-between align-items-end mb-4 animate-fade-in">
      <div>
        <h2 class="fw-bold mb-1 text-dark">Tổng Quan Tồn Kho</h2>
      </div>
      <div class="d-flex gap-2">
        <button class="btn btn-outline-modern d-flex align-items-center gap-2" onclick="showHistory()">
          <i class="bi bi-clock-history text-primary"></i><span>Lịch Sử</span>
        </button>
        <button class="btn btn-outline-modern d-flex align-items-center gap-2" onclick="exportReport()">
          <i class="bi bi-file-earmark-excel-fill text-success"></i><span>Xuất Báo Cáo</span>
        </button>
        <button class="btn btn-primary-modern d-flex align-items-center gap-2" data-bs-toggle="modal"
          data-bs-target="#sessionModal">
          <i class="bi bi-plus-lg"></i><span>Ghi Nhận Giao Dịch</span>
        </button>
      </div>
    </div>

    <div class="row g-4 mb-4 animate-fade-in" style="animation-delay: 0.1s;">
      <div class="col-md-4">
        <div class="stat-card">
          <div class="d-flex align-items-center gap-3">
            <div class="stat-icon-wrapper bg-primary bg-opacity-10 text-primary"><i class="bi bi-box-seam"></i></div>
            <div>
              <h6 class="text-muted text-uppercase fw-bold mb-1" style="font-size: 0.7rem;">Tổng Vật Tư</h6>
              <h3 class="fw-bold mb-0" id="totalItemsDisplay">142</h3>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card">
          <div class="d-flex align-items-center gap-3">
            <div class="stat-icon-wrapper bg-success bg-opacity-10 text-success"><i class="bi bi-currency-dollar"></i>
            </div>
            <div>
              <h6 class="text-muted text-uppercase fw-bold mb-1" style="font-size: 0.7rem;">Giá Trị Tồn</h6>
              <h3 class="fw-bold mb-0 text-dark" id="totalValueDisplay">0</h3>
            </div>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="stat-card">
          <div class="d-flex align-items-center gap-3">
            <div class="stat-icon-wrapper bg-warning bg-opacity-10 text-warning"><i
                class="bi bi-lightning-charge-fill"></i></div>
            <div>
              <h6 class="text-muted text-uppercase fw-bold mb-1" style="font-size: 0.7rem;">Sắp Hết Hàng</h6>
              <h3 class="fw-bold mb-0 text-dark" id="lowStockDisplay">0</h3>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="table-card animate-fade-in" style="animation-delay: 0.2s;">
      <div class="px-4 py-3 d-flex justify-content-between align-items-center border-bottom border-light">
        <div class="d-flex gap-2 align-items-center"><span class="badge bg-light text-dark border">Live Data</span>
        </div>
        <div class="d-flex gap-2">
          <select class="form-select form-select-sm border-0 bg-light fw-semibold" style="width: auto;"
            id="rowsPerPage">
            <option value="10">10 dòng</option>
            <option value="20">20 dòng</option>
          </select>
        </div>
      </div>
      <div class="table-responsive no-scrollbar">
        <table class="table table-custom w-100 align-middle mb-0">
          <thead>
            <tr>
              <th width="5%" class="ps-4">#</th>
              <th width="15%">Mã VT</th>
              <th width="35%">Tên Vật Tư</th>
              <th width="10%" class="text-center">ĐVT</th>
              <th width="15%" class="text-end">Đơn Giá</th>
              <th width="10%" class="text-center">Tồn Kho</th>
              <th width="10%" class="text-end pe-4">Thành Tiền</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
      <div class="px-4 py-3 border-top border-light d-flex justify-content-between align-items-center bg-white">
        <small class="text-muted fw-bold" id="pageInfo">...</small>
        <nav>
          <ul class="pagination pagination-sm mb-0 gap-1" id="paginationControl"></ul>
        </nav>
      </div>
    </div>
  </div>

  <div class="modal fade" id="sessionModal" data-bs-backdrop="static" tabindex="-1">
    <div class="modal-dialog modal-xl modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg" style="border-radius: 20px;">
        <div class="modal-header border-0 pb-0 pt-4 px-4">
          <h5 class="fw-bold mb-0">Ghi Nhận Giao Dịch</h5>
          <button type="button" class="btn-close bg-light rounded-circle" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="row g-4">
            <div class="col-lg-7">
              <div class="p-4 bg-light rounded-4 h-100">
                <div class="d-flex justify-content-between align-items-center mb-2">
                  <label class="small fw-bold text-muted text-uppercase mb-0">1. Chọn Vật Tư</label>
                  <button class="btn btn-sm btn-outline-primary fw-bold" style="font-size: 0.75rem;"
                    onclick="openAddModal('')"><i class="bi bi-plus-circle me-1"></i> Tạo Mới</button>
                </div>
                <div class="position-relative mb-4">
                  <i class="bi bi-search position-absolute text-muted" style="left: 15px; top: 14px;"></i>
                  <input type="text" class="form-control search-input-modern" id="materialSearchInput"
                    placeholder="Nhập tên hoặc mã VT..." autocomplete="off">
                  <div class="search-results-dropdown" id="materialSearchResults"></div>
                  <div id="selectedItemDisplay" class="mt-2 text-primary fw-bold small" style="min-height: 24px;"></div>
                  <input type="hidden" id="selectedMaterialId">
                </div>
                <div class="row mb-4">
                  <div class="col-6">
                    <label class="small fw-bold text-muted text-uppercase mb-2">Số lượng</label>
                    <input type="number" class="form-control border-0 py-3 fw-bold text-center fs-5 shadow-sm"
                      id="inputQty" value="1" min="0.1">
                  </div>
                </div>
                <label class="small fw-bold text-muted text-uppercase mb-2">2. Hành Động</label>
                <div class="action-btn-group">
                  <button class="btn-action" id="btnNhap" onclick="selectAction('NHAP')"><i
                      class="bi bi-download text-success"></i> Nhập</button>
                  <button class="btn-action" id="btnXuat" onclick="selectAction('XUAT')"><i
                      class="bi bi-upload text-danger"></i> Xuất</button>
                  <button class="btn-action" id="btnChuyen" onclick="selectAction('DIEUCHUYEN')"><i
                      class="bi bi-arrow-right-circle text-warning"></i> Chuyển</button>
                </div>
                <div id="destWarehouseWrapper" class="mt-3 animate-fade-in" style="display:none;">
                  <label class="small fw-bold text-muted mb-1">Đến kho nào?</label>
                  <select class="form-select border-0 shadow-sm py-3 fw-bold text-warning" id="destWarehouse">
                    <option value="">-- Chọn Kho Đích --</option>
                    <option value="2">trạm Bình Thuận</option>
                    <option value="3">Trạm Bình Định</option>
                  </select>
                </div>
                <button class="btn btn-primary-modern w-100 mt-4 py-3" onclick="commitAction()">Thêm Vào Danh
                  Sách</button>
              </div>
            </div>
            <div class="col-lg-5">
              <div class="border rounded-4 h-100 d-flex flex-column overflow-hidden bg-white position-relative">
                <div class="p-3 border-bottom bg-light d-flex justify-content-between">
                  <span class="fw-bold small text-uppercase">Danh sách (<span id="itemCountBadge">0</span>)</span>
                  <span class="text-danger small fw-bold" style="cursor: pointer;" onclick="clearAllDraft()">Xóa
                    hết</span>
                </div>
                <div class="flex-grow-1 overflow-auto p-0 no-scrollbar" style="max-height: 400px; position: relative;">
                  <table class="table table-hover mb-0 align-middle small">
                    <tbody id="sessionListBody" class="border-top-0"></tbody>
                  </table>
                  <div id="emptyState"
                    class="d-flex flex-column align-items-center justify-content-center text-muted p-4 h-100 w-100 position-absolute top-0 start-0 bg-white"
                    style="z-index: 5;">
                    <div class="bg-light rounded-circle p-3 mb-2"><i class="bi bi-basket2 fs-1 opacity-25"></i></div>
                    <small class="fw-semibold">Chưa có giao dịch nào</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer border-0 px-4 pb-4">
          <button type="button" class="btn btn-light rounded-3 fw-bold" data-bs-dismiss="modal">Đóng</button>
          <button type="button" class="btn btn-dark rounded-3 fw-bold px-4" onclick="finishAndSave()">Hoàn Tất</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="historyModal" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content border-0 shadow-lg rounded-4">
        <div class="modal-header border-0 bg-light">
          <h5 class="fw-bold mb-0"><i class="bi bi-journal-text me-2"></i>Nhật Ký Giao Dịch</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-0">
          <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
              <thead class="table-light sticky-top">
                <tr>
                  <th class="ps-4">Tên Phiếu (Log)</th>
                  <th>Kho thực hiện</th>
                  <th class="text-end pe-4">Chi tiết</th>
                </tr>
              </thead>
              <tbody id="historyTableBody"></tbody>
            </table>
          </div>
          <div id="emptyHistoryMsg" class="text-center text-muted py-5 d-none">Chưa có nhật ký nào</div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="transactionDetailModal" tabindex="-1" style="z-index: 1060;">
    <div class="modal-dialog modal-lg modal-dialog-centered">
      <div class="modal-content border-0 shadow rounded-4">
        <div class="modal-header bg-primary text-white border-0">
          <div>
            <h6 class="modal-title fw-bold mb-0" id="detailModalTitle">Chi Tiết Phiếu</h6>
            <small id="detailModalSubtitle" class="opacity-75">...</small>
          </div>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-0">
          <div class="table-responsive no-scrollbar" style="max-height: 400px;">
            <table class="table table-striped mb-0 align-middle">
              <thead class="table-light sticky-top">
                <tr>
                  <th class="ps-4">Vật Tư</th>
                  <th class="text-center">Hành động</th>
                  <th class="text-end pe-4">Số lượng</th>
                </tr>
              </thead>
              <tbody id="detailTableBody"></tbody>
            </table>
          </div>
        </div>
        <div class="modal-footer border-0 py-2">
          <button type="button" class="btn btn-sm btn-secondary fw-bold" data-bs-dismiss="modal">Đóng</button>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="addMaterialModal" tabindex="-1" style="z-index: 1070;">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg rounded-4">
        <div class="modal-header bg-primary text-white border-0">
          <h5 class="modal-title fw-bold"><i class="bi bi-plus-circle me-2"></i>Thêm Vật Tư Mới</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <div class="mb-3"><label class="small fw-bold text-muted text-uppercase mb-1">Mã Vật Tư</label><input
              type="text" class="form-control fw-bold" id="newMatCode" placeholder="Nhập mã (VD: VT001)..."></div>
          <div class="mb-3"><label class="small fw-bold text-muted text-uppercase mb-1">Tên Vật Tư</label><input
              type="text" class="form-control" id="newMatName" placeholder="Nhập tên vật tư..."></div>
          <div class="mb-3"><label class="small fw-bold text-muted text-uppercase mb-1">Nhóm Vật Tư</label><select
              class="form-select" id="newMatGroup">
              <option value="1">NHIÊN LIỆU</option>
              <option value="2">VẬT TƯ KHÁC</option>
              <option value="3">VẬT TƯ CẤP THEO PHAO ĐÓNG MỚI</option>
              <option value="4">VẬT TƯ THÀNH PHẨM</option>
            </select></div>
          <div class="row">
            <div class="col-6 mb-3"><label class="small fw-bold text-muted mb-1">ĐVT</label><select class="form-select"
                id="newMatUnit">
                <option>kg</option>
                <option>Cái</option>
                <option>Bộ</option>
                <option>tấm</option>
              </select></div>
            <div class="col-6 mb-3"><label class="small fw-bold text-muted mb-1">Giá</label><input type="number"
                class="form-control" id="newMatPrice" value="0"></div>
          </div>
        </div>
        <div class="modal-footer border-0 p-4 pt-0">
          <button type="button" class="btn btn-light fw-bold" data-bs-dismiss="modal">Hủy</button>
          <button type="button" class="btn btn-primary fw-bold" onclick="saveNewMaterial()">Lưu</button>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./js/scripts.js"></script>
</body>

</html>